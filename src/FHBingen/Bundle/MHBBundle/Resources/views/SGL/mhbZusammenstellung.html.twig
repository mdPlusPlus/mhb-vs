{% extends 'FHBingenMHBBundle::layout.html.twig' %}

{% block content %}
    <style type="text/css">

        #mhbWrapper {
            float: left;
        }

        #angeboteDiv {
            padding: 5px 5px 0 5px;
            margin: 5px 0 0 0;
        }

        .angebotDiv {

        }

        .angebot {
            list-style-type: none;
            margin: 0 0 5px 0;
            padding: 5px 5px 0 5px;
        }

        .angebot li {
            margin: 0 0 5px 0;
            text-align: center;
            background: url('{{ asset('bundles/fhbingenmhb/images/bg-white.jpg')}} ') top left repeat;

        }

        .angebot, .angebot li {
            min-height: 42px;
        }

        .angebot, .angebot li, #angeboteDiv {
            border: 1px solid gray;

        }

        #nichtMhbWrapper {
            /*float: right;*/
            margin-left: 55%;
        }

        #mhbWrapper, #nichtMhbWrapper {
            text-align: center;
        }


    </style>

    <script type="text/javascript">
        $(document).ready(function () {
            highlightMe(document.getElementById('mhbErstellungLink'));
        });

        $(function () {
            {% for key in zuordnung|keys %}
            {% set js = 'jQuery("#' ~ key|replace({' ': '_'}) ~ '").height(jQuery("#' ~ key|replace({' ': '_'}) ~ '").height());' %}
            {{ js|raw  }}
            {% endfor %}

            //jQuery("#angeboteWrapper").height(jQuery("#angeboteWrapper").height());
            //jQuery("#mhb").height(jQuery("#angeboteWrapper").height());
            //jQuery("#angeboteWrapper").height(jQuery("#mhbWrapper").height());

            $(".angebot").sortable({
                appendTo: 'body',
                tolerance: 'pointer',
                //connectWith: '#mhb',
                revert: 'invalid',
                forceHelperSize: true,
                helper: 'original',
                placeholder: "angebot li",
                scroll: true
            }).disableSelection();

            /*
             $("#mhb").sortable({
             appendTo: 'body',
             tolerance: 'pointer',
             connectWith: '.angebot',
             revert: 'invalid',
             forceHelperSize: true,
             helper: 'original',
             scroll: true
             }).disableSelection();
             */
        });

    </script>

    {# TODO: vllt vorher $_POST leeren? wegen zurück button im browser #}
    <form method="POST" action="{{ path('mhbErstellungParsen') }}">
        <input type="hidden" name="mhbGueltigAb" value="{{ mhbGueltigAb }}"/>
        <input type="hidden" name="mhbBeschreibung" value="{{ mhbBeschreibung }}"/>

        <div id="mhbWrapper">
            <h3>Modulhandbuch</h3>
            <div id="angeboteDiv">
            {% for key in zuordnung|keys %}
                <div class="angebotDiv">
                <h4>{{ key }}</h4>
                <ul id="{{ key|replace({' ': '_'}) }}" class="angebot">
                    {% for angebot in zuordnung[key] %}
                        <li>
                            {#<label>#}
                            <input type="hidden" name="{{ angebot }}" value="{{ angebot.getAngebotsID() }}"/>
                            {{ angebot ~ ' (' ~ angebot.getAngebotsart() ~ ')' }} {# Angebotsart hier sinnvoll? #}
                            {# if Veranstaltung des Angebots seit letzter MHB-Erstullung geändert #}
                            {% if angebot.getVeranstaltung().getErstellungsdatum().getTimestamp() > neuestesMHBDateTime.getTimestamp() %}
                                {# TODO: Achtung! Es wird nur auf das Datum, nicht auf Stunde, Minute, Sekunde überprüft #}
                                {# then Angebot als geändert markieren #}
                                <span style="color: red">{{ 'GEÄNDERT' }}</span>
                            {% endif %}
                            {#</label>#}
                        </li>
                    {% endfor %}
                </ul>
                </div>
            {% endfor %}
            </div>
        </div>

        <div class="ourButtons">
            {# <button class="btn btn-default" type="reset">zurücksetzen</button> #}
            <button class="btn btn-primary" type="submit">abschicken</button>
        </div>
    </form>

    <div id="nichtMhbWrapper">
        <h3>NICHT_MHB</h3>
        <ul>
        </ul>
    </div>

    {% include '@FHBingenMHB/flashbags.html.twig' %}

{% endblock %}